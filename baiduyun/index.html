<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>百度云 网盘</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="css/style.css" rel="stylesheet">
<link rel="stylesheet" href="css/base.css">
<link rel="shortcut icon" href="images/favicon.ico"/>
</head>
<body>
	<div id="file-box"></div>
	<ul id="file-menu">
		<li>重命名</li>
		<li>删除</li>
	</ul>
	<ul id="doc-menu">
		<li>新建文件夹</li>
	</ul>
	<div class="box">
		<div id="header">
			<span class="logo"></span>
			<ul class="item-left">
				<li><a href="">主页</a></li>
				<li><a href="" class="active">网盘</a></li>
				<li><a href="">分享</a></li>
				<li><a href="">应用</a></li>
			</ul>
			<div class="item-right">
				<ul>
					<li class="search">
						<form action="index_submit" method="get" accept-charset="utf-8">
							<input type="text" name="" placeholder="搜索你的文件">
							<input type="submit" name="" value="搜索">
						</form>
					</li>
					<li><a href="" class="user">用户信息</a></li>
					<li><a href="">会员中心</a></li>
					<li><a href="">客户端下载</a></li>
					<li><a href="">通知</a></li>
					<li style="border: none"><a href="">更多</a></li>
				</ul>
			<!-- 	<div class="clear"></div> -->
			</div>
			<div class="vip">超级会员 &nbsp;限时优惠</div>
		</div>
		<div class="left-part"><!-- 这层div是用来固定位置占位使用的 -->
			<div class="left-part-bg"><!-- 这层是用来设置背景，边框 -->
				<div class="items">
					<ul>
						<li><a href="#" class="active"><i class="all-file"></i><span>全部文件</span></a></li>
						<li><a href="#"><i class="pic"></i><span>图片</span></a></li>
						<li><a href="#"><i class="docu"></i><span>文档</span></a></li>
						<li><a href="#"><i class="movie"></i><span>视频</span></a></li>
						<li><a href="#"><i class="bt"></i><span>种子</span></a></li>
						<li><a href="#"><i class="music"></i><span>音乐</span></a></li>
						<li><a href="#"><i class="other"></i><span>其他</span></a></li>
						<li><a href="#"><i class="share"></i><span>我的分享</span></a></li>
						<li><a href="#"><i class="del"></i><span>回收站</span></a></li>
					</ul>	
				</div>
				<div class="phone">
					<a href=""><span></span>同步盘</a>
					<a href=""><span></span>Android</a>
					<a href=""><span></span>iPhone</a>
					<a href=""><span></span>更多</a>
				</div>
				<div style="height: 80px;"></div>
				<div class="gb">
					<div class="gb-box">
						<div id="step">
							<span></span>
						</div>
						<span id="data"><em>201.19G</em>/2055G</span>
						<a href="#">扩容</a>
					</div>
				</div>
			</div>
		</div>
		<div class="main-box">
			<div class="main">
				<div class="left-head">
					<div class="left-head-tool ">
						<span class="buttons dropdown upload-box"><span class="buttons-box"><i class="btn-icon upload"></i><span style="width: 40px;">上传</span><input type="file" name="" value="上传" id="upload"></span></span>
						<a href="javascript:;" class="buttons" id="folderAdd"><span class="buttons-box"><i class="btn-icon newfolder"></i><span>新建文件夹</span></span></a>
						<a href="javascript:;" class="buttons"><span class="buttons-box"><i class="btn-icon download"></i><span>离线下载</span></span></a>
						<span class="buttons dropdown device-box"><span class="buttons-box"><i class="btn-icon device"></i><span>我的设备</span></span></span>
					</div>
					<div id="">
						<div></div>
						<div></div>
					</div>
				</div>
				<div class="file-detail">
					<div class="file-total">
						<!-- <span>全部文件</span>
						<span id="total">已全部加载，共<em>6</em>个</span> -->
						<a href="javascript:;">返回上一级</a> |
						<a href="javascript:;">全部文件</a> 
					</div>
					<!-- 文件夹类型显示布局 -->
					<div class="file-tool">
						<input type="checkbox" id="allChecked">
						<div id="fileToolBox">
							<span>已选中<em id="folderNum">6</em>个文件/文件夹</span>
							<a href="javascript:;"  class="buttons" id="delete"><span class="buttons-box"><i class="btn-icon delete"></i><span>删除</span></span></a>
							<a href="javascript:;"  class="buttons" id="rename"><span class="buttons-box"><span>重命名</span></span></a>
							<a href="javascript:;"></a>
							<a href="javascript:;"></a>
							<a href="javascript:;"></a>
							<a href="javascript:;"></a>
						</div>
					</div>
					<div class="folders">
						<!-- <div class="folder-box">
							<div class="folder checked">
								<span class="checkbox"></span>
							</div>
							<div class="folder-text show"><a href="javascript:;">66666</a></div>
							<div class="rename-folder ">
								<input type="text" name=" " >
								<span class="sure"></span>
								<span class="cancel"></span>
							</div>
						</div> -->
						<div class="clear"></div>
					</div>

					<!-- table类型显示布局 -->
					<!-- <div class="tab">
						<div class="tab-head">
							<div><input type="checkbox" name="allChecked"><span>文件名</span></div>
							<div><span>大小</span></div>
							<div><span>修改时间</span></div>
						</div>
						<div class="tab-body">
							<div><input type="checkbox" name="folder"><span>CSS书籍</span></div>
							<div><span>160.4M</span></div>
							<div><span>2012-12-12 12:12</span></div>
						</div>
					</div> -->
				</div>
			</div>
		</div>
	</div>
	
<script src="js/data.js" type="text/javascript" ></script>
<script src="js/tools.js" type="text/javascript" ></script>
<script>
var fileBox = document.getElementById('file-box'); 	//框选方框
var folders = document.getElementsByClassName('folders')[0];
var folderBox = document.getElementsByClassName('folder-box');
var folder = document.getElementsByClassName('folder');
var folderText = document.getElementsByClassName('folder-text');

//用来限制鼠标点击范围
var fileTool = document.getElementsByClassName('file-tool')[0];
var leftPart = document.getElementsByClassName('left-part')[0];
var maxTop = fileTool.getBoundingClientRect().top + fileTool.offsetHeight;
var maxLeft = leftPart.getBoundingClientRect().width;

var oAdd = document.getElementById('folderAdd');
var allChecked = document.getElementById('allChecked');
var toolBox = document.getElementById('fileToolBox');
var oDel = document.getElementById('delete');
var oRename = document.getElementById('rename');
var navBox = document.getElementsByClassName('file-total')[0];  //存放面包屑导航
var navChild = navBox.getElementsByTagName('a');

window.location.hash = 'path=/'; //初始化哈希
var path = [];	//存放按顺序创建的面包屑导航各项
var arrMove = [];  //被选中准备移动的文件夹
var target= null;  //放移动的目标文件夹

for(var i = 0;i<navChild.length;i++){
	path.push(navChild[i]);
}				
// console.log(path);
var folderNum = document.getElementById('folderNum');//显示已选中多少个文件
var aChecked = document.getElementsByClassName('checkbox');  //获取左上角的checkbox
var nowId = 0;  //根据nowId获取数据并显示页面
showData();

window.onhashchange = function(){
	showNav();
	showData();
	Num();
}

oAdd.onclick = function(){
	if(ifEdit()){
		return false;
	}
	create({name:'新建文件夹',id:maxId()+1,pId:nowId},1);
}

oDel.onclick = deleteItem;  //删除按钮
oRename.onclick = fileRename; //重命名按钮

allChecked.onclick = function(e){   //全选按钮
	// e.cancelBubble = true;
	if(allChecked.checked){
		for(var i = 0;i<aChecked.length;i++){
			folder[i].className += ' active';
			folder[i].checked =  true;
			aChecked[i].className += ' checked';
		}
	}else{
		for(var i = 0;i<aChecked.length;i++){
			folder[i].className = 'folder';
			folder[i].checked =  false;
			aChecked[i].className  = 'checkbox';
		}
	}
	allChecked.checked = !allChecked.checked;
	Num();
}

navChild[0].onclick = function(){
	if(path.length>3){
		path.pop();
	}else if(path.length == 3){
		nowId = 0;
		path.splice(2);
		window.location.hash = 'path=/';
		return;
	}else if(path.length == 2){
		return;
	}
	nowId = path[path.length-1].oid;
	var str = '';
	for(var i=0;i<path.length;i++){
		str += path[i].innerHTML + '/';
	}
	window.location.hash = 'path=/' +　str;
}

navChild[1].onclick = function(){
	console.log(path);
	nowId = 0;
	path.splice(2);
	window.location.hash = 'path=/';    
}

//框选（画方框）
document.onmousedown = function(e){
	
	var l = e.clientX;
	var t = e.clientY;
	document.onmousemove = function(e){
		Num();
		fileBox.style.display = 'block';
		var iL = e.clientX;
		var iT = e.clientY;
		//计算方块宽高
		var w = Math.abs(l-iL);
		var h = Math.abs(t-iT);
		//计算方块定位left,top
		var n = l<iL?l:iL;
		var m = t<iT?t:iT;

		if(m<maxTop){  //限定方框范围
			m = maxTop;
		}
		fileBox.style.width = w + 'px';
		fileBox.style.height = h + 'px';
		fileBox.style.left = n + 'px';
		fileBox.style.top = m + 'px';
		for(var i=0;i<folder.length;i++){
			folder[i].className = 'folder';
			folder[i].checked = false;
			folder[i].getElementsByClassName('checkbox')[0].className ='checkbox';
		}
		for(var i=0;i<folderBox.length;i++){
			if(duang(fileBox,folderBox[i])){
				folder[i].checked = true;
				folder[i].className += ' active';
				folder[i].getElementsByClassName('checkbox')[0].className +=' checked';
			}
		}
	}
	document.onmouseup = function(e){
		fileBox.style.cssText = '';
		document.onmousemove = document.onmouseup = null;
		
	}
	return false;
}

// 事件都加在folder上，而不是folder-box，这样只需要在里面的span阻止冒泡就可以了
// 通过修改数据渲染页面数据！！！不需要额外修改dom结构
// 核心就是在子集中阻止父级的事件
</script>
</body>
</html>